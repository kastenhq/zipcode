language: go

go:
  - 1.11

env:
  - GO111MODULE=on
  - KUBECONFIG=kubectl_cfg

vote:
  on_success:
    Verified: 1
    Code-Review: 2
  on_failure:
    Verified: -1
    Code-Review: -2

build:

  pre_ci:
    - echo -e "${ZIPCODEK8SCFG_INTEGRATION_KUBECONFIGCONTENT}" > kubectl_cfg
    - kubectl create namespace "${BRANCH}-${BUILD_NUMBER}"

  ci:
    - go mod download
    - go build -v ./cmd/zipcode

  on_success:
    - echo -e "${ZIPCODEK8SCFG_INTEGRATION_KUBECONFIGCONTENT}" > kubectl_cfg
    - kubectl delete namespace "${BRANCH}-${BUILD_NUMBER}"
    - shipctl post_resource_state "zipcode-img" "versionName" "${BRANCH}.${BUILD_NUMBER}"



integrations:
  hub:
    - integrationName: dockerhub-kastenio
      type: dockerRegistryLogin
