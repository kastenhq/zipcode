language: go

go:
  - 1.11

env:
  - GO111MODULE=on

vote:
  on_success:
    Verified: 1
    Code-Review: 2
  on_failure:
    Verified: -1
    Code-Review: -2

build:

  pre_ci:
    - env
    - ls -l ${ZIPCODEK8SCFG_STATE}
    - echo -e "${ZIPCODEK8SCFG_INTEGRATION_KUBECONFIGCONTENT}" > kubectl_cfg
    - cat kubectl_cfg
    - KUBECONFIG=kubectl_cfg kubectl create namespace "${BRANCH}-${BUILD_NUMBER}"

  ci:
    - go build ./..

  on_success:
    - echo ${ZIPCODEK8SCFG_INTEGRATION_KUBECONFIGCONTENT} > kubectl_cfg
    - KUBECONFIG=kubectl_cfg kubectl delete namespace "${BRANCH}-${BUILD_NUMBER}"
    - shipctl post_resource_state "zipcode-img" "versionName" "${BRANCH}.${BUILD_NUMBER}"



integrations:
  hub:
    - integrationName: dockerhub-kastenio
      type: dockerRegistryLogin
